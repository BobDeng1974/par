<style type="text/css">
#diagram {
    background:#303030;
    width:115px;
    height:5120px;
    padding:5px
}
</style>

<script src="http://cdnjs.cloudflare.com/ajax/libs/bonsai/0.4/bonsai.min.js">
</script>

<div id="diagram">
</div>

<script>

function main()
{
    var colors = [
        '#f33',
        '#0d0',
        '#dd0',
        '#2af'
    ]
    for (var i = 0; i < 256; i++) {
        new Text('' + i).addTo(stage).attr({
            x: 24,
            y: 4 + i * 20,
            fontFamily: 'Arial, sans-serif',
            fontSize: '15',
            textFillColor: '#aaa',
            textStrokeWidth: 0 });
        var d = i & 0x3;
        var c = (i >> 2) & 0x3;
        var b = (i >> 4) & 0x3;
        var a = (i >> 6) & 0x3;
        new Text('' + a + b + c + d).addTo(stage).attr({
            x: 55,
            y: 4 + i * 20,
            fontFamily: 'Arial, sans-serif',
            fontSize: '15',
            textFillColor: '#e77',
            textStrokeWidth: 0 });

        var x = 0;
        new Rect(x + 1, 1 + i * 20, 18, 18)
            .addTo(stage)
            .attr('fillColor', '#555');
        var nw = new Circle(x + 4,  i * 20 + 4,  2).addTo(stage);
        var ne = new Circle(x + 16, i * 20 + 4,  2).addTo(stage);
        var sw = new Circle(x + 4,  i * 20 + 16, 2).addTo(stage);
        var se = new Circle(x + 16, i * 20 + 16, 2).addTo(stage);
        sw.fill(colors[a]);
        se.fill(colors[b]);
        ne.fill(colors[c]);
        nw.fill(colors[d]);

        var x = 95;
        new Rect(x + 1, 1 + i * 20, 18, 18)
            .addTo(stage)
            .attr('fillColor', '#555');
        var nw = new Circle(x + 4,  i * 20 + 4,  2).addTo(stage);
        var ne = new Circle(x + 16, i * 20 + 4,  2).addTo(stage);
        var sw = new Circle(x + 4,  i * 20 + 16, 2).addTo(stage);
        var se = new Circle(x + 16, i * 20 + 16, 2).addTo(stage);
        sw.fill(colors[a]);
        se.fill(colors[b]);
        ne.fill(colors[c]);
        nw.fill(colors[d]);

        var pts = [
            [x + 4,  i * 20 + 16], // sw 0
            [x + 10, i * 20 + 16], // s  1
            [x + 16, i * 20 + 16], // se 2
            [x + 16, i * 20 + 10], // e  3
            [x + 16, i * 20 + 4],  // ne 4
            [x + 10, i * 20 + 4],  // n  5
            [x + 4,  i * 20 + 4],  // nw 6
            [x + 4,  i * 20 + 10], // w  7
            [x + 10, i * 20 + 10], // center
        ];

        var draw_triangle = function(color_index, a, b, c) {
            var pa = pts[a];
            var pb = pts[b];
            var pc = pts[c];
            var tri0 = new Path()
                .moveTo(pa[0], pa[1])
                .lineTo(pb[0], pb[1])
                .lineTo(pc[0], pc[1])
                .closePath();
            tri0.addTo(stage);
            tri0.stroke('#000');
            tri0.attr({
                strokeWidth: 0.5,
                join: 'round'
            });
            tri0.fill(colors[color_index]);
        };

        if (a == b && b == c && c == d) {
            draw_triangle(a, 0, 2, 4);
            draw_triangle(a, 4, 6, 0);
            continue;
        }

        if (a != b && b != c && c != d && a != c && a != d && b != d) {
            draw_triangle(a, 0, 1, 8);
            draw_triangle(a, 8, 7, 0);
            draw_triangle(b, 1, 2, 3);
            draw_triangle(b, 3, 8, 1);
            draw_triangle(c, 8, 3, 4);
            draw_triangle(c, 4, 5, 8);
            draw_triangle(d, 7, 8, 5);
            draw_triangle(d, 5, 6, 7);
            continue;
        }

        if (a == b && b == c) {
            draw_triangle(a, 0, 2, 4); // TODO
            draw_triangle(d, 7, 5, 6);
            continue;
        }

    }
}

var el = document.getElementById('diagram');

bonsai.run(el, {
    code: main,
    width: 115,
    height: 5120
});

// setTimeout(function() {
//     window.console.log(el.children[0].innerHTML);
// }, 5000);

</script>